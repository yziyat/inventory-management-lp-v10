@if (authService.isLoggedIn() && currentRoute() !== '/login') {
<div class="lg:flex h-screen bg-gray-50">
  <!-- Sidebar -->
  <aside
    class="inset-y-0 left-0 bg-gray-900 text-white flex flex-col z-40 transform transition-all duration-300 ease-in-out"
    [class.fixed]="!isSidebarPinned() || isMobileMenuOpen()" [class.lg:relative]="isSidebarPinned()"
    [class.lg:fixed]="!isSidebarPinned()" [class.translate-x-0]="isMobileMenuOpen()"
    [class.-translate-x-full]="!isMobileMenuOpen()" [class.lg:translate-x-0]="true"
    [class.w-64]="isSidebarExpanded()" [class.w-20]="!isSidebarExpanded()"
    [class.shadow-2xl]="!isSidebarPinned() && isSidebarHovered()" (mouseenter)="isSidebarHovered.set(true)"
    (mouseleave)="isSidebarHovered.set(false)">

    <!-- Header -->
    <div class="flex items-center h-20 px-6 border-b border-gray-700 overflow-hidden whitespace-nowrap relative">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
        class="w-8 h-8 min-w-[2rem] text-sky-400 transition-all duration-300" [class.mr-3]="isSidebarExpanded()"
        [class.mx-auto]="!isSidebarExpanded()">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
      </svg>
      <span class="text-xl font-semibold text-white transition-opacity duration-300"
        [class.opacity-100]="isSidebarExpanded()" [class.opacity-0]="!isSidebarExpanded()"
        [class.w-0]="!isSidebarExpanded()" [class.hidden]="!isSidebarExpanded()">
        Inventory LP
      </span>

      <!-- Pin Button (Desktop only) -->
      @if (isSidebarExpanded()) {
      <button (click)="isSidebarPinned.set(!isSidebarPinned())"
        class="absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-400 hover:text-white rounded-md hover:bg-gray-800 hidden lg:block"
        [title]="isSidebarPinned() ? 'Unpin Sidebar' : 'Pin Sidebar'">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="w-4 h-4">
          @if (isSidebarPinned()) {
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
          } @else {
          <path stroke-linecap="round" stroke-linejoin="round" d="M18.75 19.5l-7.5-7.5 7.5-7.5m-6 15L5.25 12l7.5-7.5" />
          }
        </svg>
      </button>
      }
    </div>

    <nav class="flex-1 px-3 py-4 space-y-1 overflow-x-hidden">
      @for (item of navItems(); track item.path) {
      <a [routerLink]="item.path" routerLinkActive="bg-sky-600/30 text-white" [routerLinkActiveOptions]="{exact: true}"
        (click)="isMobileMenuOpen.set(false)"
        class="flex items-center px-3 py-2.5 text-gray-400 hover:bg-gray-800 hover:text-white transition-colors duration-200 rounded-lg group whitespace-nowrap"
        [title]="!isSidebarExpanded() ? getNavLabel(item.label) : ''">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="w-6 h-6 min-w-[1.5rem] transition-all duration-300" [class.mr-3]="isSidebarExpanded()"
          [class.mx-auto]="!isSidebarExpanded()">
          @switch (item.icon) {
          @case ('archive-box') {
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08M15.75 18.75a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5A3.375 3.375 0 0 0 6.375 7.5H5.25a2.25 2.25 0 0 0-2.25 2.25v9.75a3.375 3.375 0 0 0 3.375 3.375h9.375Z" />
          }
          @case ('document-duplicate') {
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" />
          }
          @case ('arrows-right-left') {
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h18m-7.5-12L21 9m0 0L16.5 4.5M21 9H3" /> }
          @case ('chart-bar') {
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
          }
          @case ('chart-pie') {
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" /> }
          @case ('user-group') {
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
          }
          @case ('cog-6-tooth') {
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
          }
          }
        </svg>
        <span class="transition-opacity duration-300" [class.opacity-100]="isSidebarExpanded()"
          [class.opacity-0]="!isSidebarExpanded()" [class.w-0]="!isSidebarExpanded()"
          [class.hidden]="!isSidebarExpanded()">
          {{ getNavLabel(item.label) }}
        </span>
      </a>
      }
    </nav>
    <!-- User menu -->
    <div class="p-4 border-t border-gray-700 overflow-hidden whitespace-nowrap">
      <div class="flex items-center gap-3" [class.justify-center]="!isSidebarExpanded()">
        <div
          class="w-10 h-10 min-w-[2.5rem] rounded-full bg-sky-600 flex items-center justify-center font-bold text-white">
          {{ authService.currentUser()?.firstName?.charAt(0)?.toUpperCase() }}
        </div>
        <div class="flex-1 overflow-hidden transition-opacity duration-300" [class.opacity-100]="isSidebarExpanded()"
          [class.opacity-0]="!isSidebarExpanded()" [class.w-0]="!isSidebarExpanded()"
          [class.hidden]="!isSidebarExpanded()">
          <p class="font-semibold truncate text-white">{{ authService.currentUser()?.firstName }} {{
            authService.currentUser()?.lastName }}</p>
          <p class="text-xs text-gray-400 capitalize truncate">{{ authService.currentUser()?.username }} ({{
            authService.currentUser()?.role }})</p>
        </div>
        <button (click)="logout()" title="Logout" class="text-gray-500 hover:text-sky-400 transition-colors"
          [class.hidden]="!isSidebarExpanded()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75" />
          </svg>
        </button>
      </div>
    </div>
  </aside>

  <!-- Overlay for mobile -->
  @if (isMobileMenuOpen()) {
  <div class="fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden" (click)="isMobileMenuOpen.set(false)"></div>
  }

  <!-- Main content -->
  <div class="flex-1 flex flex-col transition-all duration-300" [class.lg:ml-20]="!isSidebarPinned()"
    [class.lg:ml-0]="isSidebarPinned()">
    <!-- Mobile Header -->
    <header class="lg:hidden flex items-center justify-between bg-white h-16 px-4 shadow-sm sticky top-0 z-20">
      <button (click)="isMobileMenuOpen.set(!isMobileMenuOpen())" class="text-gray-600" aria-label="Toggle mobile menu">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
      </button>
      <h1 class="text-lg font-semibold text-gray-800">{{ pageTitle() }}</h1>
      <div class="w-6"></div> <!-- Spacer -->
    </header>

    <main class="flex-1 overflow-y-auto">
      <div class="p-4 sm:p-6 lg:p-8">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>
} @else {
<router-outlet></router-outlet>
}
<app-notification></app-notification>
<app-confirmation-modal></app-confirmation-modal>